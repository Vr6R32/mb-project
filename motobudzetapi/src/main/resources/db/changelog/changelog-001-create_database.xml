<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                                       http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.8.xsd">


    <changeSet id="create_city_states_table" author="michal-k">
        <createTable tableName="city_states">
            <column name="id" type="bigint">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="varchar(50)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>


    <changeSet id="test" author="michal-k">
        <createTable tableName="cities">
            <column name="id" type="bigserial" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="e_longitude" type="double precision">
                <constraints nullable="false"/>
            </column>
            <column name="n_latitude" type="double precision">
                <constraints nullable="false"/>
            </column>
            <column name="state_id" type="bigint">
                <constraints nullable="true" foreignKeyName="fk8akwkumky4alc0edjtn1ypr1o" referencedTableName="city_states" referencedColumnNames="id"/>
            </column>
            <column name="name" type="varchar(150)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="1" author="michal-k">
        <createTable tableName="brands">
            <column name="id" type="bigserial" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="varchar(255)">
                <constraints nullable="false" unique="true"/> <!-- Dodana opcja unique -->
            </column>
        </createTable>
    </changeSet>



    <changeSet id="5" author="michal-k">
        <createTable tableName="models">
            <column name="id" type="bigserial" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="brand_id" type="bigint">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="6" author="michal-k">
        <createTable tableName="brands_model_list">
            <column name="brand_id" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="model_list_id" type="bigint">
                <constraints nullable="false" unique="true"/>
            </column>
        </createTable>
    </changeSet>



    <changeSet id="8" author="michal-k">
        <createTable tableName="app_user">
            <column name="id" type="bigserial">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="email" type="varchar(255)">
                <constraints unique="true" nullable="false"/>
            </column>
            <column name="user_name" type="varchar(255)">
                <constraints unique="true" nullable="false"/>
            </column>
            <column name="password" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="role" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="city_id" type="bigint">
            </column>
            <column name="account_enabled" type="boolean"/>
            <column name="account_not_expired" type="boolean"/>
            <column name="account_not_locked" type="boolean"/>
            <column name="credentials_not_expired" type="boolean"/>
            <column name="register_code" type="varchar(255)"/>
            <column name="name" type="varchar(255)"/>
            <column name="surname" type="varchar(255)"/>
            <column name="phone_number" type="varchar(255)"/>
            <column name="reset_password_code" type="varchar(255)"/>
            <column name="reset_password_code_expiration" type="TIMESTAMP"/>

        </createTable>
    </changeSet>

    <changeSet id="12" author="michal-k">
        <addForeignKeyConstraint baseTableName="app_user" baseColumnNames="city_id"
                                 referencedTableName="cities" referencedColumnNames="id"
                                 constraintName="fk_city_id"/>
    </changeSet>




    <changeSet id="create_advertisements_table_sql" author="michal-k">
        <sql>
            CREATE TABLE advertisements (
                id UUID PRIMARY KEY NOT NULL,
                status VARCHAR(255) NOT NULL,
                brand_id BIGINT NOT NULL,
                city_id BIGINT,
                model_id BIGINT NOT NULL,
                name VARCHAR(255) NOT NULL,
                main_photo_url VARCHAR(255),
                create_date TIMESTAMP NOT NULL,
                last_modified TIMESTAMP,
                last_modified_by BIGINT,
                engine_capacity BIGINT,
                engine_horse_power BIGINT,
                first_registration_date DATE,
                mileage BIGINT,
                mileage_unit VARCHAR(255),
                price BIGINT,
                price_unit VARCHAR(255),
                production_date BIGINT,
                description VARCHAR(60000),
                drive_type VARCHAR(255) NOT NULL,
                engine_type VARCHAR(255) NOT NULL,
                fuel_type VARCHAR(255) NOT NULL,
                transmission_type VARCHAR(255) NOT NULL,
                user_id BIGINT NO
                FOREIGN KEY (brand_id) REFERENCES brands (id),
                FOREIGN KEY (city_id) REFERENCES cities (id),
                FOREIGN KEY (model_id) REFERENCES models (id),
                FOREIGN KEY (user_id) REFERENCES app_user (id)
            );
        </sql>
    </changeSet>

    <changeSet id="13" author="michal-k">
        <createTable tableName="advertisement_images">
            <column name="advertisement_id" type="uuid">
                <constraints nullable="false"/>
            </column>
            <column name="image_urls" type="varchar(255)"/>
        </createTable>
    </changeSet>

    <changeSet id="create-token-table" author="michal-k">
        <sql>
            CREATE TABLE tokens (
                id BIGSERIAL PRIMARY KEY,
                token VARCHAR(400) NOT NULL UNIQUE,
                token_type VARCHAR(255) NOT NULL DEFAULT 'BEARER',
                revoked BOOLEAN NOT NULL DEFAULT FALSE,
                expired BOOLEAN NOT NULL DEFAULT FALSE,
                user_id INT NOT NULL
            );
        </sql>
    </changeSet>


    <changeSet id="create_user_favourites_table" author="michal-k">
        <createTable tableName="user_favourites">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="app_user_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="advertisement_id" type="VARCHAR(255)">
                <constraints nullable="true"/>
            </column>
            <column name="user_name" type="VARCHAR(255)">
                <constraints nullable="true"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="create_user_favourites_table_constraint" author="michal-k">
        <addForeignKeyConstraint baseTableName="user_favourites"
                                 baseColumnNames="app_user_id"
                                 referencedTableName="app_user"
                                 referencedColumnNames="id"
                                 constraintName="fk_favourites_app_user"
                                 onDelete="CASCADE"/>
    </changeSet>


    <!--    <changeSet id="14" author="michal-k">-->
<!--        <addForeignKeyConstraint baseTableName="advertisements"-->
<!--                                 baseColumnNames="brand_id"-->
<!--                                 constraintName="fk_brand_advertisement"-->
<!--                                 referencedTableName="brands"-->
<!--                                 referencedColumnNames="id"-->
<!--                                 onDelete="CASCADE"/>-->
<!--        <addForeignKeyConstraint baseTableName="advertisements"-->
<!--                                 baseColumnNames="model_id"-->
<!--                                 constraintName="fk_model_advertisement"-->
<!--                                 referencedTableName="models"-->
<!--                                 referencedColumnNames="id"-->
<!--                                 onDelete="CASCADE"/>-->
<!--    </changeSet>-->


</databaseChangeLog>
